<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calend√°rio Digital - Responsabilidades Fiscais 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #334155;
            --text-primary: #fbbf24;
            --text-secondary: #fcd34d;
            --border-color: #475569;
        }

        [data-theme="light"] {
            --bg-primary: linear-gradient(135deg, #fef3c7 0%, #fde68a 50%, #fca5a5 100%);
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #7c2d12;
            --text-secondary: #92400e;
            --border-color: #f59e0b;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.5s ease;
            min-height: 100vh;
        }

        [data-theme="light"] body {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 50%, #fca5a5 100%);
        }

        .theme-transition * {
            transition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease !important;
        }
        
        .blur-background {
            filter: blur(8px) brightness(0.7);
            transition: filter 0.6s ease;
        }
        
        .login-modal {
            backdrop-filter: blur(20px) saturate(150%);
            background: rgba(15, 23, 42, 0.8);
        }

        [data-theme="light"] .login-modal {
            background: rgba(255, 255, 255, 0.9);
        }
        
        .login-form {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(226, 232, 240, 0.8);
            color: #1e293b;
            position: relative;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        [data-theme="dark"] .login-form {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(71, 85, 105, 0.8);
            color: #f1f5f9;
        }

        .login-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
        }

        .login-form input {
            background: rgba(248, 250, 252, 0.8) !important;
            border: 1px solid rgba(226, 232, 240, 0.6) !important;
            color: #334155 !important;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .login-form input {
            background: rgba(51, 65, 85, 0.8) !important;
            border: 1px solid rgba(71, 85, 105, 0.6) !important;
            color: #e2e8f0 !important;
        }

        .login-form input:focus {
            outline: none;
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: rgba(255, 255, 255, 0.95) !important;
        }

        [data-theme="dark"] .login-form input:focus {
            background: rgba(30, 41, 59, 0.95) !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .login-form label {
            color: #475569 !important;
            font-weight: 500;
        }

        [data-theme="dark"] .login-form label {
            color: #cbd5e1 !important;
        }

        .login-title {
            color: #1e293b !important;
            font-weight: 700;
            font-size: 28px;
        }

        [data-theme="dark"] .login-title {
            color: #f1f5f9 !important;
        }

        .login-subtitle {
            color: #64748b !important;
        }

        [data-theme="dark"] .login-subtitle {
            color: #94a3b8 !important;
        }

        .google-btn {
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid rgba(226, 232, 240, 0.8) !important;
            color: #374151 !important;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .google-btn {
            background: rgba(51, 65, 85, 0.9) !important;
            border: 1px solid rgba(71, 85, 105, 0.8) !important;
            color: #e5e7eb !important;
        }

        .google-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .separator-text {
            background: rgba(255, 255, 255, 0.95) !important;
            color: #6b7280 !important;
        }

        [data-theme="dark"] .separator-text {
            background: rgba(30, 41, 59, 0.95) !important;
            color: #9ca3af !important;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s ease;
        }

        [data-theme="dark"] .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .calendar-day {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .calendar-day::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s ease;
        }
        
        .calendar-day:hover::before {
            left: 100%;
        }
        
        .calendar-day:hover {
            transform: translateY(-6px) scale(1.08) rotateX(5deg);
            box-shadow: 0 20px 40px rgba(0,0,0,0.25), 0 0 20px rgba(102, 126, 234, 0.3);
            z-index: 10;
            border-color: rgba(102, 126, 234, 0.5) !important;
        }

        .calendar-day.today {
            background: var(--primary-gradient);
            color: white;
            font-weight: bold;
            animation: todayPulse 3s infinite, todayGlow 2s infinite alternate;
            transform: scale(1.02);
        }

        @keyframes todayPulse {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.8);
            }
            50% { 
                box-shadow: 0 0 0 15px rgba(102, 126, 234, 0);
            }
        }

        @keyframes todayGlow {
            0% { 
                filter: brightness(1) saturate(1);
            }
            100% { 
                filter: brightness(1.2) saturate(1.3);
            }
        }

        .event-indicator {
            animation: eventBounce 0.6s ease-out;
            animation-delay: calc(var(--delay, 0) * 0.1s);
        }

        @keyframes eventBounce {
            0% { 
                transform: scale(0) rotate(180deg);
                opacity: 0;
            }
            50% { 
                transform: scale(1.3) rotate(90deg);
                opacity: 0.8;
            }
            100% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        .event-indicator {
            width: 12px;
            height: 3px;
            border-radius: 2px;
            margin: 1px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .event-fgts { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .event-inss { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .event-irrf { background: linear-gradient(135deg, #10b981, #059669); }
        .event-pis { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .event-rais { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .event-dirf { background: linear-gradient(135deg, #ec4899, #db2777); }
        .event-folha { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .event-holiday { background: linear-gradient(135deg, #dc2626, #b91c1c); }
        .event-birthday { background: linear-gradient(135deg, #f97316, #ea580c); }
        
        .holiday-day { 
            background: linear-gradient(135deg, #fef2f2, #fee2e2); 
            border: 2px solid #dc2626;
            color: #dc2626;
        }

        [data-theme="dark"] .holiday-day {
            background: linear-gradient(135deg, #450a0a, #7f1d1d);
            color: #fca5a5;
        }
        
        .month-card {
            transition: all 0.3s ease;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .month-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
            transform: scaleX(0);
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .month-card::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            transform: scale(0);
            transition: transform 0.6s ease;
            pointer-events: none;
        }

        [data-theme="light"] .month-card::before {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        
        .month-card:hover::before {
            transform: scaleX(1);
        }

        .month-card:hover::after {
            transform: scale(1);
        }
        
        .month-card:hover {
            transform: translateY(-12px) scale(1.03) rotateY(2deg);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2), 0 0 30px rgba(102, 126, 234, 0.2);
            z-index: 5;
            border-color: rgba(102, 126, 234, 0.4);
        }
        
        .month-header {
            background: var(--primary-gradient);
            position: relative;
            overflow: hidden;
        }
        
        .modal-content {
            transition: all 0.4s ease;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .btn-gradient {
            background: var(--primary-gradient);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-gradient:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .floating-nav {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            z-index: 40;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: floatIn 0.8s ease-out;
            backdrop-filter: blur(10px);
        }

        @keyframes floatIn {
            0% {
                opacity: 0;
                transform: translateY(-50%) translateX(100px) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translateY(-50%) translateX(0) scale(1);
            }
        }

        .floating-nav:hover {
            transform: translateY(-50%) scale(1.08) rotateY(5deg);
            box-shadow: 0 30px 60px rgba(0,0,0,0.25), 0 0 40px rgba(102, 126, 234, 0.3);
        }

        .floating-nav button {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .floating-nav button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.3) 0%, transparent 70%);
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .floating-nav button:hover::before {
            width: 100px;
            height: 100px;
        }

        .floating-nav button:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 12px 24px rgba(0,0,0,0.25);
        }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .filter-chip::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .filter-chip:hover::before {
            left: 100%;
        }

        .filter-chip:hover {
            transform: translateY(-4px) scale(1.08);
            box-shadow: 0 12px 25px rgba(0,0,0,0.2), 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .filter-chip.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
            animation: activeChipPulse 2s infinite;
        }

        @keyframes activeChipPulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(102, 126, 234, 0);
            }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .floating-nav {
                position: fixed;
                bottom: 20px;
                right: 20px;
                top: auto;
                transform: none;
            }

            .calendar-day {
                height: 60px;
                font-size: 14px;
            }

            .event-indicator {
                width: 10px;
                height: 2px;
            }
        }

        /* Shake animation for form validation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="min-h-screen theme-transition" data-theme="light">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 login-modal flex items-center justify-center z-50">
        <div class="rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 login-form">
            <div class="text-center mb-8">
                <div class="w-16 h-16 mx-auto mb-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center">
                    <i data-lucide="calendar" class="w-8 h-8 text-white"></i>
                </div>
                <h2 class="login-title mb-2">Calend√°rio Digital</h2>
                <p class="login-subtitle">Entre com sua conta para continuar</p>
            </div>
            
            <div id="loginForm">
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="loginEmail" class="w-full p-3 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300" placeholder="Digite seu email">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Senha</label>
                    <div class="relative">
                        <input type="password" id="loginPassword" class="w-full p-3 pr-12 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300" placeholder="Digite sua senha">
                        <button type="button" onclick="togglePasswordVisibility('loginPassword', 'loginToggle')" id="loginToggle" class="absolute right-3 top-1/2 transform -translate-y-1/2 hover:scale-110 focus:outline-none transition-all duration-300" style="color: var(--text-secondary);">
                            <i data-lucide="eye" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                <button onclick="signInWithEmail()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white p-3 rounded-xl font-semibold mb-4 transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    <i data-lucide="log-in" class="w-5 h-5 inline mr-2"></i>Entrar
                </button>
                <div class="mb-4">
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t" style="border-color: var(--border-color);"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 separator-text">ou</span>
                        </div>
                    </div>
                </div>
                <button onclick="signInWithGoogle()" class="w-full p-3 rounded-xl font-semibold mb-4 transition-all duration-300 flex items-center justify-center space-x-2 hover:scale-105 google-btn">
                    <svg class="w-5 h-5" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    <span>Entrar com Google</span>
                </button>
                <button onclick="showRegisterForm()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white p-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-[1.02] focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                    <i data-lucide="user-plus" class="w-5 h-5 inline mr-2"></i>Criar Nova Conta
                </button>
            </div>
            
            <div id="registerForm" class="hidden">
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Email</label>
                    <input type="email" id="registerEmail" class="w-full p-3 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300" placeholder="Digite seu email">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Senha</label>
                    <div class="relative">
                        <input type="password" id="registerPassword" class="w-full p-3 pr-12 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300" placeholder="Crie uma senha (m√≠n. 6 caracteres)">
                        <button type="button" onclick="togglePasswordVisibility('registerPassword', 'registerToggle')" id="registerToggle" class="absolute right-3 top-1/2 transform -translate-y-1/2 hover:scale-110 focus:outline-none transition-all duration-300" style="color: var(--text-secondary);">
                            <i data-lucide="eye" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-2">Confirmar Senha</label>
                    <div class="relative">
                        <input type="password" id="confirmPassword" class="w-full p-3 pr-12 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-300" placeholder="Confirme sua senha">
                        <button type="button" onclick="togglePasswordVisibility('confirmPassword', 'confirmToggle')" id="confirmToggle" class="absolute right-3 top-1/2 transform -translate-y-1/2 hover:scale-110 focus:outline-none transition-all duration-300" style="color: var(--text-secondary);">
                            <i data-lucide="eye" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                <button onclick="createAccountWithEmail()" class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white p-3 rounded-xl font-semibold mb-4 transition-all duration-300 transform hover:scale-[1.02]">
                    <i data-lucide="user-plus" class="w-5 h-5 inline mr-2"></i>Criar Conta
                </button>
                <button onclick="showLoginForm()" class="w-full bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-xl font-semibold transition-all duration-300">
                    <i data-lucide="arrow-left" class="w-5 h-5 inline mr-2"></i>Voltar ao Login
                </button>
            </div>
            
            <div id="loginMessage" class="mt-4 text-center text-sm hidden"></div>
        </div>
    </div>

    <!-- Floating Navigation -->
    <div id="floatingNav" class="floating-nav hidden">
        <div class="flex flex-col space-y-3">
            <button onclick="toggleTheme()" class="p-3 rounded-lg transition-all duration-300 hover:scale-110" style="background: var(--bg-card); border: 1px solid var(--border-color);" title="Alternar tema">
                <i data-lucide="sun" class="w-5 h-5" id="themeIcon" style="color: var(--text-primary);"></i>
            </button>
            <button onclick="showTimeline()" class="p-3 rounded-lg transition-all duration-300 hover:scale-110" style="background: var(--bg-card); border: 1px solid var(--border-color);" title="Pr√≥ximos eventos">
                <i data-lucide="clock" class="w-5 h-5" style="color: var(--text-primary);"></i>
            </button>
        </div>
    </div>

    <div id="mainContent" class="container mx-auto px-4 py-8 blur-background">
        <!-- Logo Space -->
        <div class="text-center mb-8">
            <div class="inline-block bg-white p-4 rounded-xl shadow-lg">
                <img src="https://imgur.com/CVsV7Ty.png" alt="Logo da Loja" class="max-h-16 object-contain">
            </div>
        </div>

        <!-- Header -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-4">
                <div class="w-20"></div>
                <h1 class="text-4xl font-bold flex-1 text-center bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent" style="font-family: 'Georgia', serif;">Calend√°rio Digital</h1>
                <div class="w-20"></div>
            </div>
            <div class="text-center">
                <div id="userWelcome" class="text-lg mb-2" style="color: var(--text-primary);"></div>
                <div id="storageStatus" class="text-sm mt-2" style="color: var(--text-secondary);"></div>
            </div>
        </div>

        <!-- Event Filters -->
        <div class="mb-8">
            <div class="flex flex-wrap gap-3 justify-center">
                <div class="filter-chip active" onclick="toggleFilter('all')" data-filter="all" style="--chip-index: 0">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    <span>Todos</span>
                </div>
                <div class="filter-chip" onclick="toggleFilter('fiscal')" data-filter="fiscal" style="--chip-index: 1">
                    <i data-lucide="file-text" class="w-4 h-4"></i>
                    <span>Fiscal</span>
                </div>
                <div class="filter-chip" onclick="toggleFilter('holidays')" data-filter="holidays" style="--chip-index: 2">
                    <i data-lucide="gift" class="w-4 h-4"></i>
                    <span>Feriados</span>
                </div>
                <div class="filter-chip" onclick="toggleFilter('birthdays')" data-filter="birthdays" style="--chip-index: 3">
                    <i data-lucide="cake" class="w-4 h-4"></i>
                    <span>Anivers√°rios</span>
                </div>
                <div class="filter-chip" onclick="toggleFilter('notes')" data-filter="notes" style="--chip-index: 4">
                    <i data-lucide="sticky-note" class="w-4 h-4"></i>
                    <span>Observa√ß√µes</span>
                </div>
            </div>
        </div>

        <!-- Year Navigation -->
        <div class="flex justify-center items-center mb-8 space-x-6">
            <button id="prevYearBtn" onclick="changeYear(-1)" class="btn-gradient text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2">
                <i data-lucide="chevron-left" class="w-5 h-5"></i>
                <span id="prevYear">2024</span>
            </button>
            <div class="text-center">
                <h2 id="currentYear" class="text-4xl font-bold transition-all duration-500 transform bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">2025</h2>
                <div class="text-sm mt-1" style="color: var(--text-secondary);">Ano atual</div>
            </div>
            <button id="nextYearBtn" onclick="changeYear(1)" class="btn-gradient text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 hover:scale-105 flex items-center space-x-2">
                <span id="nextYear">2026</span>
                <i data-lucide="chevron-right" class="w-5 h-5"></i>
            </button>
        </div>

        <!-- Legend -->
        <div class="rounded-2xl shadow-lg p-6 mb-8 glass-effect" style="background: var(--bg-card); border: 1px solid var(--border-color);">
            <h3 class="text-xl font-bold mb-4 flex items-center" style="color: var(--text-primary);">
                <i data-lucide="info" class="w-5 h-5 mr-2"></i>
                Legenda das Obriga√ß√µes
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-fgts"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">FGTS</span>
                </div>
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-inss"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">INSS</span>
                </div>
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-irrf"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">IRRF</span>
                </div>
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-pis"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">PIS</span>
                </div>
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-rais"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">RAIS</span>
                </div>
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-dirf"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">DIRF</span>
                </div>
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-folha"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">Folha</span>
                </div>
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-birthday"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">Anivers√°rios</span>
                </div>
                <div class="flex items-center space-x-3 p-2 rounded-lg transition-all duration-300 hover:scale-105" style="background: var(--bg-secondary);">
                    <div class="event-indicator event-holiday"></div>
                    <span class="text-sm font-medium" style="color: var(--text-primary);">Feriados</span>
                </div>
            </div>
        </div>

        <!-- Calendar Grid -->
        <div id="calendarGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Months will be generated here -->
        </div>

        <!-- Event Details Modal -->
        <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="rounded-xl p-6 max-w-md mx-4 modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="modalTitle" class="text-xl font-bold" style="color: var(--text-primary);"></h3>
                    <button onclick="closeModal()" class="hover:scale-110 transition-all duration-300" style="color: var(--text-secondary);">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div id="modalContent" style="color: var(--text-secondary);"></div>
                <button onclick="closeModal()" class="mt-4 btn-gradient text-white px-4 py-2 rounded-xl w-full">
                    Fechar
                </button>
            </div>
        </div>

        <!-- Notes Modal -->
        <div id="notesModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="rounded-xl p-6 max-w-md mx-4 w-full modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="notesModalTitle" class="text-xl font-bold flex items-center" style="color: var(--text-primary);">
                        <i data-lucide="sticky-note" class="w-5 h-5 mr-2"></i>Observa√ß√µes
                    </h3>
                    <button onclick="closeNotesModal()" class="hover:scale-110 transition-all duration-300" style="color: var(--text-secondary);">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Adicionar observa√ß√£o:</label>
                    <textarea id="noteInput" class="w-full p-3 border rounded-xl resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300" style="border-color: var(--border-color); background: var(--bg-secondary); color: var(--text-primary);" rows="4" placeholder="Digite sua observa√ß√£o aqui..."></textarea>
                </div>
                <div class="flex space-x-3">
                    <button onclick="saveNote()" class="flex-1 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300">
                        <i data-lucide="save" class="w-4 h-4 inline mr-1"></i>Salvar
                    </button>
                    <button onclick="deleteNote()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300">
                        <i data-lucide="trash-2" class="w-4 h-4 inline mr-1"></i>Excluir
                    </button>
                    <button onclick="closeNotesModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300">
                        Cancelar
                    </button>
                </div>
                <div id="existingNote" class="mt-4 p-3 rounded-xl hidden" style="background: var(--bg-secondary);">
                    <h4 class="font-semibold mb-2" style="color: var(--text-primary);">Observa√ß√£o atual:</h4>
                    <p id="existingNoteText" style="color: var(--text-secondary);"></p>
                </div>
            </div>
        </div>

        <!-- Birthday Modal -->
        <div id="birthdayModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="rounded-xl p-6 max-w-md mx-4 w-full modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="birthdayModalTitle" class="text-xl font-bold flex items-center" style="color: var(--text-primary);">
                        <i data-lucide="cake" class="w-5 h-5 mr-2"></i>Anivers√°rios
                    </h3>
                    <button onclick="closeBirthdayModal()" class="hover:scale-110 transition-all duration-300" style="color: var(--text-secondary);">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-2" style="color: var(--text-primary);">Nome da pessoa:</label>
                    <input type="text" id="birthdayInput" class="w-full p-3 border rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-300" style="border-color: var(--border-color); background: var(--bg-secondary); color: var(--text-primary);" placeholder="Digite o nome da pessoa...">
                </div>
                <div class="flex space-x-3">
                    <button onclick="saveBirthday()" class="flex-1 bg-gradient-to-r from-orange-500 to-pink-500 hover:from-orange-600 hover:to-pink-600 text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300">
                        <i data-lucide="cake" class="w-4 h-4 inline mr-1"></i>Salvar
                    </button>
                    <button onclick="deleteBirthday()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300">
                        <i data-lucide="trash-2" class="w-4 h-4 inline mr-1"></i>Excluir
                    </button>
                    <button onclick="closeBirthdayModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-xl font-semibold transition-all duration-300">
                        Cancelar
                    </button>
                </div>
                <div id="existingBirthday" class="mt-4 p-3 rounded-xl hidden" style="background: var(--bg-secondary);">
                    <h4 class="font-semibold mb-2" style="color: var(--text-primary);">Anivers√°rio atual:</h4>
                    <p id="existingBirthdayText" style="color: var(--text-secondary);"></p>
                </div>
            </div>
        </div>
        
        <!-- Timeline Modal -->
        <div id="timelineModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
            <div class="rounded-2xl p-6 max-w-md mx-4 w-full modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold flex items-center" style="color: var(--text-primary);">
                        <i data-lucide="clock" class="w-5 h-5 mr-2"></i>
                        Pr√≥ximos Eventos
                    </h3>
                    <button onclick="closeTimelineModal()" class="hover:scale-110 transition-all duration-300" style="color: var(--text-secondary);">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <div id="timelineContent" class="max-h-96 overflow-y-auto">
                    <!-- Timeline items will be generated here -->
                </div>
                <button onclick="closeTimelineModal()" class="mt-4 btn-gradient text-white px-4 py-2 rounded-xl w-full">
                    Fechar
                </button>
            </div>
        </div>

        <!-- Action Buttons Section -->
        <div class="mt-16 mb-8 text-center">
            <div class="space-y-4">
                <!-- Digital Agenda Button -->
                <div class="flex justify-center">
                    <a href="https://necleg.github.io/Agenda/" target="_blank" id="digitalAgendaBtn" class="group relative inline-flex items-center justify-center px-8 py-4 text-lg font-bold text-white transition-all duration-300 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 rounded-2xl hover:from-indigo-700 hover:via-purple-700 hover:to-pink-700 focus:outline-none focus:ring-4 focus:ring-purple-300 hover:scale-105 transform hover:shadow-2xl hover:shadow-purple-500/25 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300 animate-pulse"></div>
                        <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                        <div class="relative flex items-center space-x-3">
                            <div class="p-2 bg-white/20 rounded-full group-hover:bg-white/30 transition-all duration-300 group-hover:rotate-12 transform">
                                <i data-lucide="calendar-plus" class="w-6 h-6"></i>
                            </div>
                            <span class="bg-gradient-to-r from-white to-gray-100 bg-clip-text text-transparent group-hover:from-white group-hover:to-white transition-all duration-300">
                                Agenda Digital
                            </span>
                            <div class="p-1 bg-white/20 rounded-full group-hover:bg-white/30 transition-all duration-300 group-hover:translate-x-1 transform">
                                <i data-lucide="external-link" class="w-4 h-4"></i>
                            </div>
                        </div>
                        <div class="absolute inset-0 rounded-2xl bg-gradient-to-r from-transparent via-white/10 to-transparent transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
                    </a>
                </div>
                
                <!-- Logout Button -->
                <div class="flex justify-center">
                    <button onclick="logout()" class="group relative inline-flex items-center justify-center px-6 py-3 text-base font-semibold text-white transition-all duration-300 bg-gradient-to-r from-red-500 to-red-600 rounded-xl hover:from-red-600 hover:to-red-700 focus:outline-none focus:ring-4 focus:ring-red-300 hover:scale-105 transform hover:shadow-lg overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-red-500 to-red-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative flex items-center space-x-2">
                            <i data-lucide="log-out" class="w-4 h-4 group-hover:rotate-12 transition-transform duration-300"></i>
                            <span>Sair</span>
                        </div>
                        <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-transparent via-white/20 to-transparent transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center py-8">
            <div class="rounded-2xl p-6 mx-4 glass-effect" style="background: var(--bg-card); border: 1px solid var(--border-color);">
                <p class="font-medium mb-2" style="color: var(--text-primary);">¬© 2025 Casa dos Cereais - Todos os direitos reservados</p>
                <p class="text-sm" style="color: var(--text-secondary);">Desenvolvido por <span class="font-semibold" style="color: var(--text-primary);">Gabriel</span></p>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK v12.0.0 -->
    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, onSnapshot, addDoc, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBhRH760_hAthw737CrzmioyZrzCeK5H8s",
            authDomain: "calendario-53e49.firebaseapp.com",
            projectId: "calendario-53e49",
            storageBucket: "calendario-53e49.firebasestorage.app",
            messagingSenderId: "352958232134",
            appId: "1:352958232134:web:90cd86a22b7564ee59bc47",
            measurementId: "G-EFQFJGXDE5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // Make Firebase services available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.googleProvider = googleProvider;
        window.firebaseSignInWithPopup = signInWithPopup;
        window.firebaseSignOut = signOut;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseCreateUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.firebaseSignInWithEmailAndPassword = signInWithEmailAndPassword;
        window.firestoreDoc = doc;
        window.firestoreSetDoc = setDoc;
        window.firestoreGetDoc = getDoc;
        window.firestoreCollection = collection;
        window.firestoreQuery = query;
        window.firestoreWhere = where;
        window.firestoreGetDocs = getDocs;
        window.firestoreOnSnapshot = onSnapshot;
        window.firestoreAddDoc = addDoc;
        window.firestoreUpdateDoc = updateDoc;
        window.firestoreDeleteDoc = deleteDoc;
        window.firestoreServerTimestamp = serverTimestamp;

        console.log('üî• Firebase inicializado com sucesso!');
    </script>
    
    <script>
        let currentYear = 2025;
        let currentNoteDate = '';
        let currentUser = null;
        let firebaseUser = null;
        let userNotes = {};
        let userBirthdays = {};
        let realtimeListener = null;
        let currentTheme = 'light';
        let activeFilters = ['all'];
        
        // Months array
        const months = [
            'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
            'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
        ];

        // Calculate Easter date for a given year
        function calculateEaster(year) {
            const a = year % 19;
            const b = Math.floor(year / 100);
            const c = year % 100;
            const d = Math.floor(b / 4);
            const e = b % 4;
            const f = Math.floor((b + 8) / 25);
            const g = Math.floor((b - f + 1) / 3);
            const h = (19 * a + b - d - g + 15) % 30;
            const i = Math.floor(c / 4);
            const k = c % 4;
            const l = (32 + 2 * e + 2 * i - h - k) % 7;
            const m = Math.floor((a + 11 * h + 22 * l) / 451);
            const month = Math.floor((h + l - 7 * m + 114) / 31);
            const day = ((h + l - 7 * m + 114) % 31) + 1;
            
            return new Date(year, month - 1, day);
        }

        // Generate holidays for multiple years
        function generateHolidays(year) {
            const holidays = {};
            
            // Calculate Easter and related dates
            const easter = calculateEaster(year);
            
            // Good Friday (2 days before Easter)
            const goodFriday = new Date(easter);
            goodFriday.setDate(easter.getDate() - 2);
            const goodFridayStr = `${goodFriday.getFullYear()}-${String(goodFriday.getMonth() + 1).padStart(2, '0')}-${String(goodFriday.getDate()).padStart(2, '0')}`;
            holidays[goodFridayStr] = 'Sexta-feira Santa';
            
            // Corpus Christi (60 days after Easter)
            const corpusChristi = new Date(easter);
            corpusChristi.setDate(easter.getDate() + 60);
            const corpusChristiStr = `${corpusChristi.getFullYear()}-${String(corpusChristi.getMonth() + 1).padStart(2, '0')}-${String(corpusChristi.getDate()).padStart(2, '0')}`;
            holidays[corpusChristiStr] = 'Corpus Christi';
            
            // National holidays
            holidays[`${year}-01-01`] = 'Confraterniza√ß√£o Universal';
            holidays[`${year}-04-21`] = 'Tiradentes';
            holidays[`${year}-05-01`] = 'Dia do Trabalhador';
            holidays[`${year}-09-07`] = 'Independ√™ncia do Brasil';
            holidays[`${year}-10-12`] = 'Nossa Senhora Aparecida';
            holidays[`${year}-11-02`] = 'Finados';
            holidays[`${year}-11-15`] = 'Proclama√ß√£o da Rep√∫blica';
            holidays[`${year}-12-25`] = 'Natal';
            
            // Municipal holidays - Quatis/RJ
            holidays[`${year}-10-07`] = 'Nossa Senhora do Ros√°rio (Quatis)';
            holidays[`${year}-11-25`] = 'Anivers√°rio de Quatis';
            
            // Municipal holidays - Itatiaia/RJ
            holidays[`${year}-03-19`] = 'S√£o Jos√© (Itatiaia)';
            holidays[`${year}-06-01`] = 'Anivers√°rio de Itatiaia';
            
            // 13th salary dates
            holidays[`${year}-11-30`] = '1¬™ Parcela do 13¬∫ Sal√°rio';
            holidays[`${year}-12-20`] = '2¬™ Parcela do 13¬∫ Sal√°rio';
            
            return holidays;
        }

        // Get holidays for current year
        function getHolidays() {
            return generateHolidays(currentYear);
        }

        // Fiscal events data
        const fiscalEvents = {
            // FGTS - 7¬∫ dia √∫til
            'fgts': {
                title: 'FGTS',
                description: 'Recolhimento do FGTS - at√© o 7¬∫ dia √∫til',
                type: 'event-fgts',
                days: [7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7] // 7¬∫ dia √∫til de cada m√™s
            },
            // INSS - 20¬∫ dia
            'inss': {
                title: 'INSS',
                description: 'Recolhimento do INSS - at√© o dia 20',
                type: 'event-inss',
                days: [20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20]
            },
            // IRRF - √∫ltimo dia √∫til
            'irrf': {
                title: 'IRRF',
                description: 'Recolhimento do IRRF - √∫ltimo dia √∫til',
                type: 'event-irrf',
                days: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31] // Ser√° ajustado para √∫ltimo dia √∫til
            },
            // PIS - 20¬∫ dia
            'pis': {
                title: 'PIS',
                description: 'Recolhimento do PIS - at√© o dia 20',
                type: 'event-pis',
                days: [20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20]
            },
            // Folha de pagamento - 5¬∫ dia √∫til
            'folha': {
                title: 'Folha de Pagamento',
                description: 'Fechamento da folha de pagamento - 5¬∫ dia √∫til',
                type: 'event-folha',
                days: [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5] // 5¬∫ dia √∫til
            }
        };

        // Firebase Authentication Functions
        async function signInWithGoogle() {
            try {
                showMessage('üîÑ Conectando com Google...');
                
                const result = await window.firebaseSignInWithPopup(window.firebaseAuth, window.googleProvider);
                firebaseUser = result.user;
                currentUser = firebaseUser.displayName || firebaseUser.email;
                
                console.log('‚úÖ Login Google realizado:', currentUser);
                showMessage('Login realizado com sucesso! üéâ');
                
                await saveUserToFirestore(firebaseUser);
                setupRealtimeSync();
                showMainContent();
                
                setTimeout(() => {
                    document.getElementById('loginModal').style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Erro no login Google:', error);
                if (error.code === 'auth/popup-closed-by-user') {
                    showMessage('Login cancelado pelo usu√°rio.', true);
                } else if (error.code === 'auth/popup-blocked') {
                    showMessage('Pop-up bloqueado. Permita pop-ups para este site.', true);
                } else {
                    showMessage('Erro no login com Google. Tente novamente.', true);
                }
            }
        }

        async function signInWithEmail() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showMessage('Por favor, preencha todos os campos!', true);
                return;
            }

            if (!isValidEmail(email)) {
                showMessage('Por favor, digite um email v√°lido!', true);
                return;
            }

            try {
                showMessage('üîÑ Fazendo login...');
                
                const userCredential = await window.firebaseSignInWithEmailAndPassword(window.firebaseAuth, email, password);
                firebaseUser = userCredential.user;
                currentUser = firebaseUser.email;
                
                console.log('‚úÖ Login com email realizado:', currentUser);
                showMessage('Login realizado com sucesso! üéâ');
                
                await saveUserToFirestore(firebaseUser);
                setupRealtimeSync();
                showMainContent();
                
                setTimeout(() => {
                    document.getElementById('loginModal').style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Erro no login com email:', error);
                
                let errorMessage = 'Erro no login. Tente novamente.';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'Usu√°rio n√£o encontrado. Verifique o email ou crie uma conta.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Senha incorreta. Tente novamente.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Email inv√°lido. Verifique o formato.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'Esta conta foi desabilitada.';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Muitas tentativas. Tente novamente mais tarde.';
                        break;
                }
                
                showMessage(errorMessage, true);
            }
        }

        async function createAccountWithEmail() {
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!email || !password || !confirmPassword) {
                showMessage('Por favor, preencha todos os campos!', true);
                return;
            }

            if (!isValidEmail(email)) {
                showMessage('Por favor, digite um email v√°lido!', true);
                return;
            }

            if (password !== confirmPassword) {
                showMessage('As senhas n√£o coincidem!', true);
                return;
            }
            
            if (password.length < 6) {
                showMessage('A senha deve ter pelo menos 6 caracteres!', true);
                return;
            }

            try {
                showMessage('üîÑ Criando conta...');
                
                const userCredential = await window.firebaseCreateUserWithEmailAndPassword(window.firebaseAuth, email, password);
                firebaseUser = userCredential.user;
                currentUser = firebaseUser.email;
                
                console.log('‚úÖ Conta criada:', currentUser);
                showMessage('Conta criada com sucesso! üéâ');
                
                await saveUserToFirestore(firebaseUser);
                setupRealtimeSync();
                showMainContent();
                
                setTimeout(() => {
                    document.getElementById('loginModal').style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('‚ùå Erro ao criar conta:', error);
                
                let errorMessage = 'Erro ao criar conta. Tente novamente.';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Este email j√° est√° em uso. Tente fazer login.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Email inv√°lido. Verifique o formato.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Senha muito fraca. Use pelo menos 6 caracteres.';
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'Cria√ß√£o de contas desabilitada.';
                        break;
                }
                
                showMessage(errorMessage, true);
            }
        }
        
        async function saveUserToFirestore(user) {
            try {
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', user.uid);
                await window.firestoreSetDoc(userRef, {
                    uid: user.uid,
                    email: user.email,
                    displayName: user.displayName || user.email,
                    photoURL: user.photoURL || null,
                    lastLogin: window.firestoreServerTimestamp(),
                    provider: user.providerData[0]?.providerId || 'email',
                    createdAt: window.firestoreServerTimestamp()
                }, { merge: true });
                
                console.log('‚úÖ Usu√°rio salvo no Firestore');
            } catch (error) {
                console.error('‚ùå Erro ao salvar usu√°rio:', error);
            }
        }
        
        function setupRealtimeSync() {
            if (!firebaseUser) return;
            
            if (realtimeListener) {
                try {
                    realtimeListener();
                } catch (e) {
                    console.log('Listener anterior removido');
                }
            }
            
            const uid = firebaseUser.uid;
            
            loadUserNotes().then(() => {
                try {
                    const eventsRef = window.firestoreCollection(window.firebaseDb, 'users', uid, 'events');
                    
                    realtimeListener = window.firestoreOnSnapshot(eventsRef, (snapshot) => {
                        const notes = {};
                        const birthdays = {};
                        
                        snapshot.docs.forEach(doc => {
                            const data = doc.data();
                            if (data.date && data.content) {
                                notes[data.date] = data.content;
                            }
                            if (data.date && data.birthday) {
                                birthdays[data.date] = data.birthday;
                            }
                        });
                        
                        console.log('üîÑ Dados sincronizados:', Object.keys(notes).length, 'notas,', Object.keys(birthdays).length, 'anivers√°rios');
                        
                        userNotes = notes;
                        userBirthdays = birthdays;
                        
                        generateCalendar();
                        updateStorageStatus('üåê Sincronizado em tempo real');
                        
                    }, (error) => {
                        console.error('‚ùå Erro no listener:', error);
                        updateStorageStatus('‚ö†Ô∏è Usando modo offline');
                        loadLocalData();
                    });
                } catch (error) {
                    console.error('‚ùå Erro ao configurar listener:', error);
                    updateStorageStatus('‚ö†Ô∏è Modo offline ativo');
                    loadLocalData();
                }
            });
        }
        
        async function loadUserNotes() {
            if (!firebaseUser) return;
            
            try {
                const uid = firebaseUser.uid;
                const eventsRef = window.firestoreCollection(window.firebaseDb, 'users', uid, 'events');
                
                const querySnapshot = await window.firestoreGetDocs(eventsRef);
                const notes = {};
                const birthdays = {};
                
                querySnapshot.docs.forEach(doc => {
                    const data = doc.data();
                    if (data.date && data.content) {
                        notes[data.date] = data.content;
                    }
                    if (data.date && data.birthday) {
                        birthdays[data.date] = data.birthday;
                    }
                });
                
                userNotes = notes;
                userBirthdays = birthdays;
                console.log('‚úÖ Dados carregados:', Object.keys(notes).length, 'notas,', Object.keys(birthdays).length, 'anivers√°rios');
                
                localStorage.setItem(`notes_${uid}`, JSON.stringify(notes));
                localStorage.setItem(`birthdays_${uid}`, JSON.stringify(birthdays));
                
                generateCalendar();
                updateStorageStatus();
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                updateStorageStatus('‚ö†Ô∏è Erro ao carregar - usando dados locais');
                loadLocalData();
            }
        }
        
        function loadLocalData() {
            if (!firebaseUser) return;
            
            try {
                const uid = firebaseUser.uid;
                const localNotes = localStorage.getItem(`notes_${uid}`);
                const localBirthdays = localStorage.getItem(`birthdays_${uid}`);
                
                userNotes = localNotes ? JSON.parse(localNotes) : {};
                userBirthdays = localBirthdays ? JSON.parse(localBirthdays) : {};
                
                console.log('üì± Dados locais carregados:', Object.keys(userNotes).length, 'notas,', Object.keys(userBirthdays).length, 'anivers√°rios');
                generateCalendar();
                updateStorageStatus('üì± Dados locais carregados');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados locais:', error);
                userNotes = {};
                userBirthdays = {};
                generateCalendar();
                updateStorageStatus('‚ùå Erro ao carregar dados');
            }
        }
        
        async function saveNoteToFirestore(date, content) {
            if (!firebaseUser) return false;
            
            try {
                const uid = firebaseUser.uid;
                const eventRef = window.firestoreDoc(window.firebaseDb, 'users', uid, 'events', date);
                
                const eventData = {
                    date: date,
                    content: content,
                    updatedAt: window.firestoreServerTimestamp(),
                    createdAt: window.firestoreServerTimestamp()
                };
                
                await window.firestoreSetDoc(eventRef, eventData, { merge: true });
                
                console.log('‚úÖ Nota salva no Firestore:', date);
                
                const localNotes = { ...userNotes };
                localNotes[date] = content;
                localStorage.setItem(`notes_${uid}`, JSON.stringify(localNotes));
                
                return true;
            } catch (error) {
                console.error('‚ùå Erro ao salvar nota:', error);
                
                try {
                    const uid = firebaseUser.uid;
                    const localNotes = { ...userNotes };
                    localNotes[date] = content;
                    localStorage.setItem(`notes_${uid}`, JSON.stringify(localNotes));
                    console.log('üì± Nota salva localmente');
                    return true;
                } catch (localError) {
                    console.error('‚ùå Erro ao salvar localmente:', localError);
                    return false;
                }
            }
        }

        async function saveBirthdayToFirestore(date, name) {
            if (!firebaseUser) return false;
            
            try {
                const uid = firebaseUser.uid;
                const eventRef = window.firestoreDoc(window.firebaseDb, 'users', uid, 'events', date);
                
                const eventData = {
                    date: date,
                    birthday: name,
                    updatedAt: window.firestoreServerTimestamp(),
                    createdAt: window.firestoreServerTimestamp()
                };
                
                await window.firestoreSetDoc(eventRef, eventData, { merge: true });
                
                console.log('‚úÖ Anivers√°rio salvo:', date, '-', name);
                
                const localBirthdays = { ...userBirthdays };
                localBirthdays[date] = name;
                localStorage.setItem(`birthdays_${uid}`, JSON.stringify(localBirthdays));
                
                return true;
            } catch (error) {
                console.error('‚ùå Erro ao salvar anivers√°rio:', error);
                
                try {
                    const uid = firebaseUser.uid;
                    const localBirthdays = { ...userBirthdays };
                    localBirthdays[date] = name;
                    localStorage.setItem(`birthdays_${uid}`, JSON.stringify(localBirthdays));
                    console.log('üì± Anivers√°rio salvo localmente');
                    return true;
                } catch (localError) {
                    console.error('‚ùå Erro ao salvar localmente:', localError);
                    return false;
                }
            }
        }

        async function deleteNoteFromFirestore(date) {
            if (!firebaseUser) return false;
            
            try {
                const uid = firebaseUser.uid;
                const eventRef = window.firestoreDoc(window.firebaseDb, 'users', uid, 'events', date);
                
                if (userBirthdays[date]) {
                    const eventData = {
                        date: date,
                        birthday: userBirthdays[date],
                        updatedAt: window.firestoreServerTimestamp()
                    };
                    await window.firestoreSetDoc(eventRef, eventData);
                } else {
                    await window.firestoreDeleteDoc(eventRef);
                }
                
                console.log('‚úÖ Nota deletada:', date);
                
                const localNotes = { ...userNotes };
                delete localNotes[date];
                localStorage.setItem(`notes_${uid}`, JSON.stringify(localNotes));
                
                return true;
            } catch (error) {
                console.error('‚ùå Erro ao deletar nota:', error);
                
                try {
                    const uid = firebaseUser.uid;
                    const localNotes = { ...userNotes };
                    delete localNotes[date];
                    localStorage.setItem(`notes_${uid}`, JSON.stringify(localNotes));
                    console.log('üì± Nota deletada localmente');
                    return true;
                } catch (localError) {
                    console.error('‚ùå Erro ao deletar localmente:', localError);
                    return false;
                }
            }
        }

        async function deleteBirthdayFromFirestore(date) {
            if (!firebaseUser) return false;
            
            try {
                const uid = firebaseUser.uid;
                const eventRef = window.firestoreDoc(window.firebaseDb, 'users', uid, 'events', date);
                
                if (userNotes[date]) {
                    const eventData = {
                        date: date,
                        content: userNotes[date],
                        updatedAt: window.firestoreServerTimestamp()
                    };
                    await window.firestoreSetDoc(eventRef, eventData);
                } else {
                    await window.firestoreDeleteDoc(eventRef);
                }
                
                console.log('‚úÖ Anivers√°rio deletado:', date);
                
                const localBirthdays = { ...userBirthdays };
                delete localBirthdays[date];
                localStorage.setItem(`birthdays_${uid}`, JSON.stringify(localBirthdays));
                
                return true;
            } catch (error) {
                console.error('‚ùå Erro ao deletar anivers√°rio:', error);
                
                try {
                    const uid = firebaseUser.uid;
                    const localBirthdays = { ...userBirthdays };
                    delete localBirthdays[date];
                    localStorage.setItem(`birthdays_${uid}`, JSON.stringify(localBirthdays));
                    console.log('üì± Anivers√°rio deletado localmente');
                    return true;
                } catch (localError) {
                    console.error('‚ùå Erro ao deletar localmente:', localError);
                    return false;
                }
            }
        }
        
        function initFirebaseAuth() {
            window.firebaseOnAuthStateChanged(window.firebaseAuth, async (user) => {
                if (user) {
                    firebaseUser = user;
                    currentUser = user.displayName || user.email;
                    console.log('üî• Usu√°rio autenticado:', currentUser);
                    
                    setupRealtimeSync();
                    
                    if (document.getElementById('loginModal').style.display !== 'none') {
                        showMainContent();
                        document.getElementById('loginModal').style.display = 'none';
                    }
                } else {
                    if (realtimeListener) {
                        try {
                            realtimeListener();
                        } catch (e) {
                            console.log('Listener removido');
                        }
                        realtimeListener = null;
                    }
                    
                    firebaseUser = null;
                    currentUser = null;
                    userNotes = {};
                    userBirthdays = {};
                    
                    console.log('üî• Usu√°rio deslogado');
                    
                    const loginModal = document.getElementById('loginModal');
                    if (loginModal && loginModal.style.display === 'none') {
                        loginModal.style.display = 'flex';
                        document.getElementById('mainContent').classList.add('blur-background');
                    }
                }
            });
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginMessage').classList.add('hidden');
        }
        
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('loginMessage').classList.add('hidden');
        }
        
        function showMessage(message, isError = false) {
            const messageDiv = document.getElementById('loginMessage');
            messageDiv.textContent = message;
            messageDiv.className = `mt-4 text-center text-sm ${isError ? 'text-red-600' : 'text-green-600'}`;
            messageDiv.classList.remove('hidden');
        }
        
        function togglePasswordVisibility(inputId, toggleId) {
            const passwordInput = document.getElementById(inputId);
            const toggleButton = document.getElementById(toggleId);
            const icon = toggleButton.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                passwordInput.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            
            lucide.createIcons();
        }
        
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', currentTheme);
            
            const themeIcon = document.getElementById('themeIcon');
            if (currentTheme === 'dark') {
                themeIcon.setAttribute('data-lucide', 'moon');
            } else {
                themeIcon.setAttribute('data-lucide', 'sun');
            }
            
            lucide.createIcons();
            localStorage.setItem('theme', currentTheme);
            
            document.body.classList.add('theme-transition');
            setTimeout(() => {
                document.body.classList.remove('theme-transition');
            }, 500);
        }

        function toggleFilter(filterType) {
            const filterChip = document.querySelector(`[data-filter="${filterType}"]`);
            
            if (filterType === 'all') {
                activeFilters = ['all'];
                document.querySelectorAll('.filter-chip').forEach(chip => {
                    chip.classList.remove('active');
                });
                filterChip.classList.add('active');
            } else {
                if (activeFilters.includes('all')) {
                    activeFilters = [];
                    document.querySelector('[data-filter="all"]').classList.remove('active');
                }
                
                if (activeFilters.includes(filterType)) {
                    activeFilters = activeFilters.filter(f => f !== filterType);
                    filterChip.classList.remove('active');
                } else {
                    activeFilters.push(filterType);
                    filterChip.classList.add('active');
                }
                
                if (activeFilters.length === 0) {
                    activeFilters = ['all'];
                    document.querySelector('[data-filter="all"]').classList.add('active');
                }
            }
            
            generateCalendar();
        }

        function showTimeline() {
            const modal = document.getElementById('timelineModal');
            const content = document.getElementById('timelineContent');
            
            const upcomingEvents = getUpcomingEvents();
            
            let timelineHTML = '';
            if (upcomingEvents.length === 0) {
                timelineHTML = '<div class="text-center py-8" style="color: var(--text-secondary);">Nenhum evento pr√≥ximo encontrado</div>';
            } else {
                upcomingEvents.forEach(event => {
                    timelineHTML += `
                        <div class="border-l-4 border-blue-500 pl-4 mb-4 pb-4">
                            <div class="font-semibold" style="color: var(--text-primary);">${event.title}</div>
                            <div class="text-sm" style="color: var(--text-secondary);">${event.date}</div>
                            <div class="text-xs mt-1" style="color: var(--text-secondary);">${event.description}</div>
                        </div>
                    `;
                });
            }
            
            content.innerHTML = timelineHTML;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeTimelineModal() {
            const modal = document.getElementById('timelineModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function getUpcomingEvents() {
            const today = new Date();
            const events = [];
            
            for (let i = 0; i < 30; i++) {
                const checkDate = new Date(today);
                checkDate.setDate(today.getDate() + i);
                
                const dateStr = `${checkDate.getFullYear()}-${String(checkDate.getMonth() + 1).padStart(2, '0')}-${String(checkDate.getDate()).padStart(2, '0')}`;
                const dayEvents = getEventsForDay(checkDate.getDate(), checkDate.getMonth() + 1);
                
                dayEvents.forEach(event => {
                    events.push({
                        ...event,
                        date: checkDate.toLocaleDateString('pt-BR'),
                        sortDate: checkDate
                    });
                });
                
                // Check holidays for this date
                const holidays = generateHolidays(checkDate.getFullYear());
                if (holidays[dateStr]) {
                    events.push({
                        title: 'Feriado',
                        description: holidays[dateStr],
                        date: checkDate.toLocaleDateString('pt-BR'),
                        sortDate: checkDate,
                        type: 'holiday'
                    });
                }
                
                if (userNotes[dateStr]) {
                    events.push({
                        title: 'Observa√ß√£o',
                        description: userNotes[dateStr],
                        date: checkDate.toLocaleDateString('pt-BR'),
                        sortDate: checkDate,
                        type: 'note'
                    });
                }
                
                if (userBirthdays[dateStr]) {
                    events.push({
                        title: 'Anivers√°rio',
                        description: userBirthdays[dateStr],
                        date: checkDate.toLocaleDateString('pt-BR'),
                        sortDate: checkDate,
                        type: 'birthday'
                    });
                }
            }
            
            return events.sort((a, b) => a.sortDate - b.sortDate).slice(0, 10);
        }

        function showMainContent() {
            document.getElementById('mainContent').classList.remove('blur-background');
            document.getElementById('userWelcome').innerHTML = `<strong>üëã Bem-vindo, ${currentUser}!</strong>`;
            
            document.getElementById('floatingNav').classList.remove('hidden');
            
            generateCalendar();
            updateStorageStatus();
            
            lucide.createIcons();
            
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme !== currentTheme) {
                toggleTheme();
            }
        }
        
        async function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                try {
                    if (realtimeListener) {
                        try {
                            realtimeListener();
                        } catch (e) {
                            console.log('Listener removido durante logout');
                        }
                        realtimeListener = null;
                    }
                    
                    currentUser = null;
                    firebaseUser = null;
                    userNotes = {};
                    userBirthdays = {};
                    
                    await window.firebaseSignOut(window.firebaseAuth);
                    console.log('‚úÖ Logout realizado');
                    
                    document.getElementById('loginModal').style.display = 'flex';
                    document.getElementById('mainContent').classList.add('blur-background');
                    
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                    document.getElementById('registerEmail').value = '';
                    document.getElementById('registerPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    
                    document.getElementById('userWelcome').innerHTML = '';
                    document.getElementById('storageStatus').textContent = '';
                    
                    showLoginForm();
                } catch (error) {
                    console.error('‚ùå Erro no logout:', error);
                    alert('Erro ao fazer logout. Tente novamente.');
                }
            }
        }
        
        function updateStorageStatus(customMessage = null) {
            const statusDiv = document.getElementById('storageStatus');
            
            if (customMessage) {
                statusDiv.textContent = customMessage;
                statusDiv.className = 'text-sm text-blue-600 mt-2';
                return;
            }
            
            const noteCount = Object.keys(userNotes).length;
            
            if (noteCount > 0) {
                let statusText = `üåê ${noteCount} observa√ß√£o${noteCount > 1 ? '√µes' : ''} sincronizada${noteCount > 1 ? 's' : ''} na nuvem`;
                statusDiv.textContent = statusText;
                statusDiv.className = 'text-sm text-green-600 mt-2';
            } else {
                statusDiv.textContent = 'üìù Nenhuma observa√ß√£o salva ainda';
                statusDiv.className = 'text-sm text-gray-500 mt-2';
            }
        }

        function changeYear(direction) {
            // Add click effect to button
            const button = event.target.closest('button');
            if (button) {
                button.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    button.style.transform = '';
                }, 150);
            }
            
            // Add transition effect to year display
            const yearDisplay = document.getElementById('currentYear');
            yearDisplay.style.transform = direction > 0 ? 'translateX(50px)' : 'translateX(-50px)';
            yearDisplay.style.opacity = '0';
            
            setTimeout(() => {
                currentYear += direction;
                updateYearDisplay();
                
                yearDisplay.style.transform = direction > 0 ? 'translateX(-50px)' : 'translateX(50px)';
                
                setTimeout(() => {
                    yearDisplay.style.transform = 'translateX(0)';
                    yearDisplay.style.opacity = '1';
                }, 50);
                
                generateCalendar();
            }, 200);
        }

        function updateYearDisplay() {
            document.getElementById('currentYear').textContent = currentYear;
            document.getElementById('prevYear').textContent = currentYear - 1;
            document.getElementById('nextYear').textContent = currentYear + 1;
        }

        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            for (let month = 0; month < 12; month++) {
                const monthCard = createMonthCard(month);
                calendarGrid.appendChild(monthCard);
            }
        }

        function createMonthCard(monthIndex) {
            const monthCard = document.createElement('div');
            monthCard.className = 'month-card rounded-2xl shadow-lg overflow-hidden';
            monthCard.style.setProperty('--month-index', monthIndex);
            
            const daysInMonth = new Date(currentYear, monthIndex + 1, 0).getDate();
            const firstDay = new Date(currentYear, monthIndex, 1).getDay();
            
            let monthHTML = `
                <div class="month-header text-white p-4 text-center">
                    <h3 class="text-xl font-bold">${months[monthIndex]}</h3>
                    <p class="text-sm opacity-90">${currentYear}</p>
                </div>
                <div class="p-4">
                    <div class="grid grid-cols-7 gap-1 mb-2">
                        <div class="text-xs font-semibold text-center p-1" style="color: var(--text-secondary);">Dom</div>
                        <div class="text-xs font-semibold text-center p-1" style="color: var(--text-secondary);">Seg</div>
                        <div class="text-xs font-semibold text-center p-1" style="color: var(--text-secondary);">Ter</div>
                        <div class="text-xs font-semibold text-center p-1" style="color: var(--text-secondary);">Qua</div>
                        <div class="text-xs font-semibold text-center p-1" style="color: var(--text-secondary);">Qui</div>
                        <div class="text-xs font-semibold text-center p-1" style="color: var(--text-secondary);">Sex</div>
                        <div class="text-xs font-semibold text-center p-1" style="color: var(--text-secondary);">S√°b</div>
                    </div>
                    <div class="grid grid-cols-7 gap-1">
            `;
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                monthHTML += '<div class="h-12"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentYear}-${String(monthIndex + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = isDateToday(currentYear, monthIndex, day);
                const holidays = getHolidays();
                const isHoliday = holidays[dateStr];
                const events = getEventsForDay(day, monthIndex + 1);
                const hasNote = userNotes[dateStr];
                const hasBirthday = userBirthdays[dateStr];
                
                let dayClasses = 'calendar-day h-12 rounded-lg flex flex-col items-center justify-center text-sm font-medium cursor-pointer relative';
                
                if (isToday) {
                    dayClasses += ' today';
                } else if (isHoliday && shouldShowEvent('event-holiday')) {
                    dayClasses += ' holiday-day';
                } else {
                    dayClasses += ' hover:bg-opacity-80';
                    dayClasses += ` text-gray-700`;
                }
                
                // Verificar se este dia deve ser mostrado baseado nos filtros ativos
                let shouldShowDay = activeFilters.includes('all');
                
                if (!shouldShowDay) {
                    // Verificar se tem eventos fiscais e filtro fiscal est√° ativo
                    if (events.length > 0 && activeFilters.includes('fiscal')) {
                        shouldShowDay = true;
                    }
                    // Verificar se √© feriado e filtro feriados est√° ativo
                    if (isHoliday && activeFilters.includes('holidays')) {
                        shouldShowDay = true;
                    }
                    // Verificar se tem anivers√°rio e filtro anivers√°rios est√° ativo
                    if (hasBirthday && activeFilters.includes('birthdays')) {
                        shouldShowDay = true;
                    }
                    // Verificar se tem observa√ß√£o e filtro observa√ß√µes est√° ativo
                    if (hasNote && activeFilters.includes('notes')) {
                        shouldShowDay = true;
                    }
                }

                // Se o dia n√£o deve ser mostrado, criar um dia vazio mas ainda clic√°vel para anivers√°rios
                if (!shouldShowDay) {
                    monthHTML += `
                        <div class="h-12 rounded-lg flex flex-col items-center justify-center text-sm opacity-30 cursor-pointer hover:opacity-60 transition-opacity duration-300" onclick="openDayModal(${day}, ${monthIndex + 1}, '${dateStr}')" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-secondary);">
                            ${hasNote ? '<div class="absolute top-1 left-1 w-2 h-2 bg-yellow-500 rounded-full shadow-sm opacity-50" title="Observa√ß√£o"></div>' : ''}
                            ${hasBirthday ? '<div class="absolute top-1 right-1 w-2 h-2 bg-gradient-to-r from-orange-500 to-pink-500 rounded-full shadow-sm" title="Anivers√°rio"></div>' : ''}
                            <span class="text-xs">${day}</span>
                            <div class="absolute bottom-0 right-0 opacity-40 hover:opacity-80 transition-opacity">
                                <i data-lucide="cake" class="w-3 h-3 text-orange-400" title="Adicionar anivers√°rio"></i>
                            </div>
                        </div>
                    `;
                } else {
                    monthHTML += `
                        <div class="${dayClasses}" onclick="openDayModal(${day}, ${monthIndex + 1}, '${dateStr}')" style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary);">
                            ${hasNote && shouldShowEvent('notes') ? '<div class="absolute top-1 left-1 w-2 h-2 bg-yellow-500 rounded-full shadow-sm" title="Observa√ß√£o"></div>' : ''}
                            ${hasBirthday && shouldShowEvent('birthdays') ? '<div class="absolute top-1 right-1 w-2 h-2 bg-gradient-to-r from-orange-500 to-pink-500 rounded-full shadow-sm" title="Anivers√°rio"></div>' : ''}
                            <span class="text-xs">${day}</span>
                            <div class="flex flex-wrap justify-center mt-1">
                    `;
                
                    // Add event indicators
                    let eventIndex = 0;
                    events.forEach(event => {
                        if (shouldShowEvent(event.type)) {
                            monthHTML += `<div class="event-indicator ${event.type}" style="--delay: ${eventIndex}" title="${event.title}"></div>`;
                            eventIndex++;
                        }
                    });
                    
                    // Add holiday indicator if it's a holiday and should be shown
                    if (isHoliday && shouldShowEvent('event-holiday')) {
                        monthHTML += `<div class="event-indicator event-holiday" style="--delay: ${eventIndex}" title="Feriado: ${isHoliday}"></div>`;
                    }
                    
                    monthHTML += '</div></div>';
                }
            }
            
            monthHTML += '</div></div>';
            monthCard.innerHTML = monthHTML;
            
            return monthCard;
        }

        function shouldShowEvent(eventType) {
            // Se "Todos" est√° ativo, mostra tudo
            if (activeFilters.includes('all')) return true;
            
            // Eventos fiscais (FGTS, INSS, IRRF, PIS, etc.)
            if (eventType.startsWith('event-') && !eventType.includes('holiday') && !eventType.includes('birthday') && activeFilters.includes('fiscal')) {
                return true;
            }
            
            // Feriados
            if (eventType === 'event-holiday' && activeFilters.includes('holidays')) {
                return true;
            }
            
            // Anivers√°rios
            if (eventType === 'birthdays' && activeFilters.includes('birthdays')) {
                return true;
            }
            
            // Observa√ß√µes/Notas
            if (eventType === 'notes' && activeFilters.includes('notes')) {
                return true;
            }
            
            return false;
        }

        function isDateToday(year, month, day) {
            const today = new Date();
            return year === today.getFullYear() && 
                   month === today.getMonth() && 
                   day === today.getDate();
        }

        function getEventsForDay(day, month) {
            const events = [];
            
            // Check fiscal events
            Object.keys(fiscalEvents).forEach(eventKey => {
                const event = fiscalEvents[eventKey];
                if (event.days[month - 1] === day) {
                    events.push(event);
                }
            });
            
            return events;
        }

        function openDayModal(day, month, dateStr) {
            // Add click effect to the day element
            const dayElement = event.target.closest('.calendar-day') || event.target;
            if (dayElement) {
                dayElement.style.transform = 'scale(0.9)';
                dayElement.style.transition = 'transform 0.15s ease';
                
                setTimeout(() => {
                    dayElement.style.transform = '';
                }, 150);
            }
            
            const events = getEventsForDay(day, month);
            const hasNote = userNotes[dateStr];
            const hasBirthday = userBirthdays[dateStr];
            const holidays = getHolidays();
            const isHoliday = holidays[dateStr];
            
            // Always show the modal with options to add birthday/notes
            // if (events.length === 0 && !hasNote && !hasBirthday && !isHoliday) {
            //     // Open notes modal for empty days
            //     openNotesModal(dateStr);
            //     return;
            // }
            
            const modal = document.getElementById('eventModal');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            
            title.textContent = `${day} de ${months[month - 1]}`;
            
            let modalHTML = '';
            
            // Show holiday
            if (isHoliday) {
                modalHTML += `
                    <div class="mb-4 p-3 bg-red-50 border-l-4 border-red-500 rounded">
                        <h4 class="font-bold text-red-800">üéâ Feriado Nacional</h4>
                        <p class="text-red-700">${isHoliday}</p>
                    </div>
                `;
            }
            
            // Show fiscal events
            events.forEach(event => {
                let bgColor = 'bg-blue-50';
                let borderColor = 'border-blue-500';
                let textColor = 'text-blue-800';
                
                if (event.type === 'event-fgts') {
                    bgColor = 'bg-red-50';
                    borderColor = 'border-red-500';
                    textColor = 'text-red-800';
                } else if (event.type === 'event-inss') {
                    bgColor = 'bg-blue-50';
                    borderColor = 'border-blue-500';
                    textColor = 'text-blue-800';
                } else if (event.type === 'event-irrf') {
                    bgColor = 'bg-green-50';
                    borderColor = 'border-green-500';
                    textColor = 'text-green-800';
                }
                
                modalHTML += `
                    <div class="mb-4 p-3 ${bgColor} border-l-4 ${borderColor} rounded">
                        <h4 class="font-bold ${textColor}">üìã ${event.title}</h4>
                        <p class="${textColor.replace('800', '700')}">${event.description}</p>
                    </div>
                `;
            });
            
            // Show user note
            if (hasNote) {
                modalHTML += `
                    <div class="mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-500 rounded">
                        <h4 class="font-bold text-yellow-800">üìù Sua Observa√ß√£o</h4>
                        <p class="text-yellow-700">${hasNote}</p>
                        <button onclick="openNotesModal('${dateStr}')" class="mt-2 text-yellow-600 hover:text-yellow-800 text-sm underline">
                            Editar observa√ß√£o
                        </button>
                    </div>
                `;
            }
            
            // Show birthday
            if (hasBirthday) {
                modalHTML += `
                    <div class="mb-4 p-3 bg-orange-50 border-l-4 border-orange-500 rounded">
                        <h4 class="font-bold text-orange-800">üéÇ Anivers√°rio</h4>
                        <p class="text-orange-700">${hasBirthday}</p>
                        <button onclick="openBirthdayModal('${dateStr}')" class="mt-2 text-orange-600 hover:text-orange-800 text-sm underline">
                            Editar anivers√°rio
                        </button>
                    </div>
                `;
            }
            
            // Add action buttons - always show both options
            modalHTML += `
                <div class="mt-6 space-y-2">
                    <div class="flex space-x-2">
                        <button onclick="openNotesModal('${dateStr}')" class="flex-1 ${hasNote ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-yellow-500 hover:bg-yellow-600'} text-white px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-300">
                            üìù ${hasNote ? 'Editar Observa√ß√£o' : 'Adicionar Observa√ß√£o'}
                        </button>
                        <button onclick="openBirthdayModal('${dateStr}')" class="flex-1 ${hasBirthday ? 'bg-orange-600 hover:bg-orange-700' : 'bg-orange-500 hover:bg-orange-600'} text-white px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-300">
                            üéÇ ${hasBirthday ? 'Editar Anivers√°rio' : 'Adicionar Anivers√°rio'}
                        </button>
                    </div>
                </div>
            `;
            
            // If no events at all, show a helpful message
            if (events.length === 0 && !hasNote && !hasBirthday && !isHoliday) {
                modalHTML = `
                    <div class="text-center py-6">
                        <div class="text-6xl mb-4">üìÖ</div>
                        <h4 class="text-lg font-semibold mb-2" style="color: var(--text-primary);">Nenhum evento hoje</h4>
                        <p class="text-sm mb-6" style="color: var(--text-secondary);">Que tal adicionar uma observa√ß√£o ou anivers√°rio?</p>
                    </div>
                ` + modalHTML;
            }
            
            content.innerHTML = modalHTML;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal() {
            document.getElementById('eventModal').classList.add('hidden');
            document.getElementById('eventModal').classList.remove('flex');
        }

        function openNotesModal(dateStr) {
            closeModal();
            
            currentNoteDate = dateStr;
            const modal = document.getElementById('notesModal');
            const input = document.getElementById('noteInput');
            const existingNote = document.getElementById('existingNote');
            const existingNoteText = document.getElementById('existingNoteText');
            
            const currentNote = userNotes[dateStr];
            
            if (currentNote) {
                input.value = currentNote;
                existingNoteText.textContent = currentNote;
                existingNote.classList.remove('hidden');
            } else {
                input.value = '';
                existingNote.classList.add('hidden');
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Add opening animation
            const modalContent = modal.querySelector('.modal-content');
            modalContent.style.transform = 'scale(0.8) translateY(-20px)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modalContent.style.transform = 'scale(1) translateY(0)';
                modalContent.style.opacity = '1';
                modalContent.style.transition = 'all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)';
                input.focus();
            }, 50);
        }

        function closeNotesModal() {
            document.getElementById('notesModal').classList.add('hidden');
            document.getElementById('notesModal').classList.remove('flex');
            currentNoteDate = '';
        }

        async function saveNote() {
            const noteText = document.getElementById('noteInput').value.trim();
            
            if (!noteText) {
                // Add shake effect to input
                const input = document.getElementById('noteInput');
                input.style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => input.style.animation = '', 500);
                alert('Por favor, digite uma observa√ß√£o!');
                return;
            }
            
            if (!currentNoteDate) {
                alert('Erro: data n√£o selecionada!');
                return;
            }
            
            // Add loading effect to save button
            const saveButton = event.target;
            const originalText = saveButton.innerHTML;
            saveButton.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 inline mr-1 animate-spin"></i>Salvando...';
            saveButton.disabled = true;
            
            const success = await saveNoteToFirestore(currentNoteDate, noteText);
            
            if (success) {
                userNotes[currentNoteDate] = noteText;
                
                // Success animation
                saveButton.innerHTML = '<i data-lucide="check" class="w-4 h-4 inline mr-1"></i>Salvo!';
                saveButton.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                
                setTimeout(() => {
                    generateCalendar();
                    updateStorageStatus();
                    closeNotesModal();
                    alert('Observa√ß√£o salva com sucesso! ‚úÖ');
                }, 800);
            } else {
                saveButton.innerHTML = originalText;
                saveButton.disabled = false;
                alert('Erro ao salvar observa√ß√£o. Tente novamente.');
            }
            
            lucide.createIcons();
        }

        async function deleteNote() {
            if (!currentNoteDate || !userNotes[currentNoteDate]) {
                alert('Nenhuma observa√ß√£o para excluir!');
                return;
            }
            
            if (!confirm('Tem certeza que deseja excluir esta observa√ß√£o?')) {
                return;
            }
            
            const success = await deleteNoteFromFirestore(currentNoteDate);
            
            if (success) {
                delete userNotes[currentNoteDate];
                generateCalendar();
                updateStorageStatus();
                closeNotesModal();
                alert('Observa√ß√£o exclu√≠da com sucesso! ‚úÖ');
            } else {
                alert('Erro ao excluir observa√ß√£o. Tente novamente.');
            }
        }

        function openBirthdayModal(dateStr) {
            closeModal();
            
            currentNoteDate = dateStr;
            const modal = document.getElementById('birthdayModal');
            const input = document.getElementById('birthdayInput');
            const existingBirthday = document.getElementById('existingBirthday');
            const existingBirthdayText = document.getElementById('existingBirthdayText');
            
            const currentBirthday = userBirthdays[dateStr];
            
            if (currentBirthday) {
                input.value = currentBirthday;
                existingBirthdayText.textContent = currentBirthday;
                existingBirthday.classList.remove('hidden');
            } else {
                input.value = '';
                existingBirthday.classList.add('hidden');
            }
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Add opening animation
            const modalContent = modal.querySelector('.modal-content');
            modalContent.style.transform = 'scale(0.8) translateY(-20px)';
            modalContent.style.opacity = '0';
            
            setTimeout(() => {
                modalContent.style.transform = 'scale(1) translateY(0)';
                modalContent.style.opacity = '1';
                modalContent.style.transition = 'all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)';
                input.focus();
            }, 50);
        }

        function closeBirthdayModal() {
            document.getElementById('birthdayModal').classList.add('hidden');
            document.getElementById('birthdayModal').classList.remove('flex');
            currentNoteDate = '';
        }

        async function saveBirthday() {
            const birthdayName = document.getElementById('birthdayInput').value.trim();
            
            if (!birthdayName) {
                // Add shake effect to input
                const input = document.getElementById('birthdayInput');
                input.style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => input.style.animation = '', 500);
                alert('Por favor, digite o nome da pessoa!');
                return;
            }
            
            if (!currentNoteDate) {
                alert('Erro: data n√£o selecionada!');
                return;
            }
            
            // Add loading effect to save button
            const saveButton = event.target;
            const originalText = saveButton.innerHTML;
            saveButton.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 inline mr-1 animate-spin"></i>Salvando...';
            saveButton.disabled = true;
            
            const success = await saveBirthdayToFirestore(currentNoteDate, birthdayName);
            
            if (success) {
                userBirthdays[currentNoteDate] = birthdayName;
                
                // Success animation
                saveButton.innerHTML = '<i data-lucide="check" class="w-4 h-4 inline mr-1"></i>Salvo!';
                saveButton.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                
                setTimeout(() => {
                    generateCalendar();
                    updateStorageStatus();
                    closeBirthdayModal();
                    alert('Anivers√°rio salvo com sucesso! üéâ');
                }, 800);
            } else {
                saveButton.innerHTML = originalText;
                saveButton.disabled = false;
                alert('Erro ao salvar anivers√°rio. Tente novamente.');
            }
            
            lucide.createIcons();
        }

        async function deleteBirthday() {
            if (!currentNoteDate || !userBirthdays[currentNoteDate]) {
                alert('Nenhum anivers√°rio para excluir!');
                return;
            }
            
            if (!confirm('Tem certeza que deseja excluir este anivers√°rio?')) {
                return;
            }
            
            const success = await deleteBirthdayFromFirestore(currentNoteDate);
            
            if (success) {
                delete userBirthdays[currentNoteDate];
                generateCalendar();
                updateStorageStatus();
                closeBirthdayModal();
                alert('Anivers√°rio exclu√≠do com sucesso! ‚úÖ');
            } else {
                alert('Erro ao excluir anivers√°rio. Tente novamente.');
            }
        }

        // Daily reminder system
        function checkDailyReminders() {
            if (!firebaseUser) return;
            
            const today = new Date();
            const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            
            const todayEvents = [];
            
            // Check fiscal events
            const fiscalEventsToday = getEventsForDay(today.getDate(), today.getMonth() + 1);
            fiscalEventsToday.forEach(event => {
                todayEvents.push({
                    type: 'fiscal',
                    title: event.title,
                    description: event.description,
                    icon: 'üìã'
                });
            });
            
            // Check holidays
            const holidays = generateHolidays(today.getFullYear());
            if (holidays[todayStr]) {
                todayEvents.push({
                    type: 'holiday',
                    title: 'Feriado',
                    description: holidays[todayStr],
                    icon: 'üéâ'
                });
            }
            
            // Check user notes
            if (userNotes[todayStr]) {
                todayEvents.push({
                    type: 'note',
                    title: 'Observa√ß√£o',
                    description: userNotes[todayStr],
                    icon: 'üìù'
                });
            }
            
            // Check birthdays
            if (userBirthdays[todayStr]) {
                todayEvents.push({
                    type: 'birthday',
                    title: 'Anivers√°rio',
                    description: userBirthdays[todayStr],
                    icon: 'üéÇ'
                });
            }
            
            // Show reminder if there are events today
            if (todayEvents.length > 0) {
                showDailyReminder(todayEvents);
            }
        }

        function showDailyReminder(events) {
            // Check if reminder was already shown today
            const today = new Date().toDateString();
            const lastReminderDate = localStorage.getItem('lastReminderDate');
            
            if (lastReminderDate === today) {
                return; // Already shown today
            }
            
            let reminderHTML = `
                <div id="dailyReminder" class="fixed top-4 right-4 z-50 max-w-sm bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 p-6 transform translate-x-full transition-all duration-500 ease-out">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white flex items-center">
                            <i data-lucide="bell" class="w-5 h-5 mr-2 text-blue-500"></i>
                            Lembretes de Hoje
                        </h3>
                        <button onclick="closeDailyReminder()" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="space-y-3">
            `;
            
            events.forEach(event => {
                let bgColor = 'bg-blue-50 dark:bg-blue-900/20';
                let textColor = 'text-blue-800 dark:text-blue-200';
                
                if (event.type === 'holiday') {
                    bgColor = 'bg-red-50 dark:bg-red-900/20';
                    textColor = 'text-red-800 dark:text-red-200';
                } else if (event.type === 'birthday') {
                    bgColor = 'bg-orange-50 dark:bg-orange-900/20';
                    textColor = 'text-orange-800 dark:text-orange-200';
                } else if (event.type === 'note') {
                    bgColor = 'bg-yellow-50 dark:bg-yellow-900/20';
                    textColor = 'text-yellow-800 dark:text-yellow-200';
                }
                
                reminderHTML += `
                    <div class="${bgColor} p-3 rounded-lg">
                        <div class="flex items-start space-x-2">
                            <span class="text-lg">${event.icon}</span>
                            <div class="flex-1">
                                <h4 class="font-semibold ${textColor} text-sm">${event.title}</h4>
                                <p class="${textColor} text-xs opacity-80">${event.description}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            reminderHTML += `
                    </div>
                    <div class="mt-4 flex space-x-2">
                        <button onclick="closeDailyReminder()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-300">
                            Fechar
                        </button>
                        <button onclick="snoozeReminder()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm font-semibold transition-all duration-300">
                            Lembrar em 1h
                        </button>
                    </div>
                </div>
            `;
            
            // Add to body
            document.body.insertAdjacentHTML('beforeend', reminderHTML);
            
            // Initialize icons
            lucide.createIcons();
            
            // Animate in
            setTimeout(() => {
                const reminder = document.getElementById('dailyReminder');
                if (reminder) {
                    reminder.style.transform = 'translateX(0)';
                }
            }, 100);
            
            // Mark as shown today
            localStorage.setItem('lastReminderDate', today);
        }

        function closeDailyReminder() {
            const reminder = document.getElementById('dailyReminder');
            if (reminder) {
                reminder.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    reminder.remove();
                }, 500);
            }
        }

        function snoozeReminder() {
            closeDailyReminder();
            
            // Set reminder to show again in 1 hour
            setTimeout(() => {
                // Remove the "shown today" flag so it can show again
                localStorage.removeItem('lastReminderDate');
                checkDailyReminders();
            }, 60 * 60 * 1000); // 1 hour
            
            // Show snooze confirmation
            const snoozeNotification = document.createElement('div');
            snoozeNotification.className = 'fixed top-4 right-4 z-50 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg';
            snoozeNotification.textContent = '‚è∞ Lembrete adiado por 1 hora';
            document.body.appendChild(snoozeNotification);
            
            setTimeout(() => {
                snoozeNotification.remove();
            }, 3000);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Aplica√ß√£o iniciada');
            
            // Initialize Firebase Auth
            initFirebaseAuth();
            
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Update year display
            updateYearDisplay();
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                toggleTheme();
            }
            
            // Check for daily reminders every minute
            setInterval(checkDailyReminders, 60000);
            
            // Check reminders on load (with delay to ensure user is logged in)
            setTimeout(checkDailyReminders, 3000);
            
            console.log('‚úÖ Inicializa√ß√£o completa');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c1280c34569417',t:'MTc1NDY3ODU3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
